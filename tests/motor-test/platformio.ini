; ================== PlatformIO unified config ==================
; Environments:
;   - esp32_dispense         -> builds src/Dispense_ESP.cpp
;   - esp32_wheel_simple     -> builds src/Wheelsimple.cpp
;   - esp32_motor_smoketest  -> builds src/MotorSmokeTest.cpp
;   - uno_dispense           -> builds src/Dispense_UNO.cpp
;
; VSCode: click the PlatformIO status bar target to switch env.
; CLI:
;   pio run -e esp32_dispense        -t upload
;   pio run -e esp32_wheel_simple    -t upload
;   pio run -e esp32_motor_smoketest -t upload
;   pio run -e uno_dispense          -t upload
; Serial Monitor:
;   pio device monitor -e <envname>

[platformio]
default_envs = esp32_wheel_simple

; -------- Shared compiler settings (applied per-env via extends) --------
[env:common]
framework = arduino
build_unflags = -std=gnu++11
build_flags   = -std=gnu++17

; Shared libraries (used by both ESP32 and UNO builds as needed)
; - AS5600 magnetic encoder (Rob Tillaart)
; - TMCStepper for TMC2208/5160, etc.
; - AccelStepper for higher-level motion control (optional but common)


; ======================= ESP32 TARGETS =========================
; Pick your ESP32 board type if different (e.g., esp32doit-devkit-v1)
[env:esp32_base]
extends = env:common
platform = espressif32
board    = esp32dev
monitor_speed   = 115200
monitor_filters = time, colorize, esp32_exception_decoder
upload_speed    = 921600

; ---- ESP32: Dispense controller (main) ----
[env:esp32_dispense]
extends = env:esp32_base
build_src_filter = +<Dispense_ESP.cpp>

; ---- ESP32: Wheel logic (encoder + motor) ----
[env:esp32_wheel_simple]
extends = env:esp32_base
build_src_filter = +<Wheelsimple.cpp>
; Example: pass compile-time spokes setting if your code uses it
; build_flags = -std=gnu++17 -D WHEEL_SPOKES=5

; ---- ESP32: Motor-only smoke test ----
[env:esp32_motor_smoketest]
extends = env:esp32_base
build_src_filter = +<MotorSmokeTest.cpp>

; ======================== UNO TARGETS ==========================
[env:uno_base]
extends = env:common
platform = atmelavr
board    = uno
monitor_speed   = 115200
monitor_filters = time, colorize
; AVR upload_speed is ignored by many programmers; leave default.

; ---- UNO: Dispense controller (UNO variant) ----
[env:uno_dispense]
extends = env:uno_base
build_src_filter = +<Dispense_UNO.cpp>
